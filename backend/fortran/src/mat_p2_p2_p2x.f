c
c***********************************************************************
c
c      Compute the integral: m_ijk = Integrate[P(i) * P(j) * D[P(k),x], over a triangle]
c
c***********************************************************************
c
      subroutine mat_p2_p2_p2x (mat, b_inv_t, det_b)
c
c***********************************************************************
c
      implicit none
      double precision mat(6,6,6), b_inv_t(2,2), det_b

      double precision dt, factor, factor2
      double precision c11, c12, c21, c22
      integer*8 i, j, k

      dt=dabs(det_b)
      c11 = b_inv_t(1, 1)
      c12 = b_inv_t(1, 2)
      c21 = b_inv_t(2, 1)
      c22 = b_inv_t(2, 2)

      mat(1, 1, 1) = -78*(c11 + c12)
      mat(1, 1, 2) = -18*c11
      mat(1, 1, 3) = -18*c12
      mat(1, 1, 4) = 24*(4*c11 - c12)
      mat(1, 1, 5) = 24*(c11 + c12)
      mat(1, 1, 6) = 24*(-c11 + 4*c12)
      mat(1, 2, 1) = 9*(c11 + c12)
      mat(1, 2, 2) = -9*c11
      mat(1, 2, 3) = 11*c12
      mat(1, 2, 4) = 16*c12
      mat(1, 2, 5) = 4*(c11 - 4*c12)
      mat(1, 2, 6) = 4*(-c11 - 5*c12)
      mat(1, 3, 1) = 9*(c11 + c12)
      mat(1, 3, 2) = 11*c11
      mat(1, 3, 3) = -9*c12
      mat(1, 3, 4) = 4*(-5*c11 - c12)
      mat(1, 3, 5) = 4*(-4*c11 + c12)
      mat(1, 3, 6) = 16*c11
      mat(1, 4, 1) = -48*(c11 + c12)
      mat(1, 4, 2) = -32*c11
      mat(1, 4, 3) = -16*c12
      mat(1, 4, 4) = 16*(5*c11 + 2*c12)
      mat(1, 4, 5) = -16*(c11 + 2*c12)
      mat(1, 4, 6) = 16*(c11 + 4*c12)
      mat(1, 5, 1) = 12*(-c11 - c12)
      mat(1, 5, 2) = -20*c11
      mat(1, 5, 3) = -20*c12
      mat(1, 5, 4) = 16*(2*c11 + 3*c12)
      mat(1, 5, 5) = -48*(c11 + c12)
      mat(1, 5, 6) = 16*(3*c11 + 2*c12)
      mat(1, 6, 1) = -48*(c11 + c12)
      mat(1, 6, 2) = -16*c11
      mat(1, 6, 3) = -32*c12
      mat(1, 6, 4) = 16*(4*c11 + c12)
      mat(1, 6, 5) = -16*(2*c11 + c12)
      mat(1, 6, 6) = 16*(2*c11 + 5*c12)
      mat(2, 1, 1) = 9*(c11 + c12)
      mat(2, 1, 2) = -9*c11
      mat(2, 1, 3) = 11*c12
      mat(2, 1, 4) = 16*c12
      mat(2, 1, 5) = 4*(c11 - 4*c12)
      mat(2, 1, 6) = 4*(-c11 - 5*c12)
      mat(2, 2, 1) = 18*(c11 + c12)
      mat(2, 2, 2) = 78*c11
      mat(2, 2, 3) = -18*c12
      mat(2, 2, 4) = 24*(-4*c11 - 5*c12)
      mat(2, 2, 5) = 24*(c11 + 5*c12)
      mat(2, 2, 6) = -24*c11
      mat(2, 3, 1) = -11*(c11 + c12)
      mat(2, 3, 2) = -9*c11
      mat(2, 3, 3) = -9*c12
      mat(2, 3, 4) = 4*(5*c11 + 4*c12)
      mat(2, 3, 5) = -16*(c11 + c12)
      mat(2, 3, 6) = 4*(4*c11 + 5*c12)
      mat(2, 4, 1) = 32*(c11 + c12)
      mat(2, 4, 2) = 48*c11
      mat(2, 4, 3) = -16*c12
      mat(2, 4, 4) = -16*(5*c11 + 3*c12)
      mat(2, 4, 5) = -16*(c11 - 3*c12)
      mat(2, 4, 6) = 16*(c11 - c12)
      mat(2, 5, 1) = 16*(c11 + c12)
      mat(2, 5, 2) = 48*c11
      mat(2, 5, 3) = -32*c12
      mat(2, 5, 4) = -16*(4*c11 + 3*c12)
      mat(2, 5, 5) = -16*(2*c11 - 3*c12)
      mat(2, 5, 6) = 16*(2*c11 + c12)
      mat(2, 6, 1) = 20*(c11 + c12)
      mat(2, 6, 2) = 12*c11
      mat(2, 6, 3) = -20*c12
      mat(2, 6, 4) = -16*(2*c11 - c12)
      mat(2, 6, 5) = -16*(3*c11 + c12)
      mat(2, 6, 6) = 48*c11
      mat(3, 1, 1) = 9*(c11 + c12)
      mat(3, 1, 2) = 11*c11
      mat(3, 1, 3) = -9*c12
      mat(3, 1, 4) = 4*(-5*c11 - c12)
      mat(3, 1, 5) = 4*(-4*c11 + c12)
      mat(3, 1, 6) = 16*c11
      mat(3, 2, 1) = -11*(c11 + c12)
      mat(3, 2, 2) = -9*c11
      mat(3, 2, 3) = -9*c12
      mat(3, 2, 4) = 4*(5*c11 + 4*c12)
      mat(3, 2, 5) = -16*(c11 + c12)
      mat(3, 2, 6) = 4*(4*c11 + 5*c12)
      mat(3, 3, 1) = 18*(c11 + c12)
      mat(3, 3, 2) = -18*c11
      mat(3, 3, 3) = 78*c12
      mat(3, 3, 4) = -24*c12
      mat(3, 3, 5) = 24*(5*c11 + c12)
      mat(3, 3, 6) = 24*(-5*c11 - 4*c12)
      mat(3, 4, 1) = 20*(c11 + c12)
      mat(3, 4, 2) = -20*c11
      mat(3, 4, 3) = 12*c12
      mat(3, 4, 4) = 48*c12
      mat(3, 4, 5) = -16*(c11 + 3*c12)
      mat(3, 4, 6) = 16*(c11 - 2*c12)
      mat(3, 5, 1) = 16*(c11 + c12)
      mat(3, 5, 2) = -32*c11
      mat(3, 5, 3) = 48*c12
      mat(3, 5, 4) = 16*(c11 + 2*c12)
      mat(3, 5, 5) = 16*(3*c11 - 2*c12)
      mat(3, 5, 6) = -16*(3*c11 + 4*c12)
      mat(3, 6, 1) = 32*(c11 + c12)
      mat(3, 6, 2) = -16*c11
      mat(3, 6, 3) = 48*c12
      mat(3, 6, 4) = -16*(c11 - c12)
      mat(3, 6, 5) = 16*(3*c11 - c12)
      mat(3, 6, 6) = -16*(3*c11 + 5*c12)
      mat(4, 1, 1) = -48*(c11 + c12)
      mat(4, 1, 2) = -32*c11
      mat(4, 1, 3) = -16*c12
      mat(4, 1, 4) = 16*(5*c11 + 2*c12)
      mat(4, 1, 5) = -16*(c11 + 2*c12)
      mat(4, 1, 6) = 16*(c11 + 4*c12)
      mat(4, 2, 1) = 32*(c11 + c12)
      mat(4, 2, 2) = 48*c11
      mat(4, 2, 3) = -16*c12
      mat(4, 2, 4) = -16*(5*c11 + 3*c12)
      mat(4, 2, 5) = -16*(c11 - 3*c12)
      mat(4, 2, 6) = 16*(c11 - c12)
      mat(4, 3, 1) = 20*(c11 + c12)
      mat(4, 3, 2) = -20*c11
      mat(4, 3, 3) = 12*c12
      mat(4, 3, 4) = 48*c12
      mat(4, 3, 5) = -16*(c11 + 3*c12)
      mat(4, 3, 6) = 16*(c11 - 2*c12)
      mat(4, 4, 1) = -160*(c11 + c12)
      mat(4, 4, 2) = 160*c11
      mat(4, 4, 3) = -96*c12
      mat(4, 4, 4) = -384*c12
      mat(4, 4, 5) = 128*(c11 + 3*c12)
      mat(4, 4, 6) = -128*(c11 - 2*c12)
      mat(4, 5, 1) = -16*(c11 + c12)
      mat(4, 5, 2) = 80*c11
      mat(4, 5, 3) = 16*c12
      mat(4, 5, 4) = -64*(c11 + 3*c12)
      mat(4, 5, 5) = 64*(2*c11 + 3*c12)
      mat(4, 5, 6) = -128*c11
      mat(4, 6, 1) = -80*(c11 + c12)
      mat(4, 6, 2) = 16*c11
      mat(4, 6, 3) = 16*c12
      mat(4, 6, 4) = 64*(c11 - 2*c12)
      mat(4, 6, 5) = 128*(c11 + c12)
      mat(4, 6, 6) = -64*(2*c11 - c12)
      mat(5, 1, 1) = 12*(-c11 - c12)
      mat(5, 1, 2) = -20*c11
      mat(5, 1, 3) = -20*c12
      mat(5, 1, 4) = 16*(2*c11 + 3*c12)
      mat(5, 1, 5) = -48*(c11 + c12)
      mat(5, 1, 6) = 16*(3*c11 + 2*c12)
      mat(5, 2, 1) = 16*(c11 + c12)
      mat(5, 2, 2) = 48*c11
      mat(5, 2, 3) = -32*c12
      mat(5, 2, 4) = -16*(4*c11 + 3*c12)
      mat(5, 2, 5) = -16*(2*c11 - 3*c12)
      mat(5, 2, 6) = 16*(2*c11 + c12)
      mat(5, 3, 1) = 16*(c11 + c12)
      mat(5, 3, 2) = -32*c11
      mat(5, 3, 3) = 48*c12
      mat(5, 3, 4) = 16*(c11 + 2*c12)
      mat(5, 3, 5) = 16*(3*c11 - 2*c12)
      mat(5, 3, 6) = -16*(3*c11 + 4*c12)
      mat(5, 4, 1) = -16*(c11 + c12)
      mat(5, 4, 2) = 80*c11
      mat(5, 4, 3) = 16*c12
      mat(5, 4, 4) = -64*(c11 + 3*c12)
      mat(5, 4, 5) = 64*(2*c11 + 3*c12)
      mat(5, 4, 6) = -128*c11
      mat(5, 5, 1) = 96*(c11 + c12)
      mat(5, 5, 2) = 160*c11
      mat(5, 5, 3) = 160*c12
      mat(5, 5, 4) = -128*(2*c11 + 3*c12)
      mat(5, 5, 5) = 384*(c11 + c12)
      mat(5, 5, 6) = -128*(3*c11 + 2*c12)
      mat(5, 6, 1) = -16*(c11 + c12)
      mat(5, 6, 2) = 16*c11
      mat(5, 6, 3) = 80*c12
      mat(5, 6, 4) = -128*c12
      mat(5, 6, 5) = 64*(3*c11 + 2*c12)
      mat(5, 6, 6) = -64*(3*c11 + c12)
      mat(6, 1, 1) = -48*(c11 + c12)
      mat(6, 1, 2) = -16*c11
      mat(6, 1, 3) = -32*c12
      mat(6, 1, 4) = 16*(4*c11 + c12)
      mat(6, 1, 5) = -16*(2*c11 + c12)
      mat(6, 1, 6) = 16*(2*c11 + 5*c12)
      mat(6, 2, 1) = 20*(c11 + c12)
      mat(6, 2, 2) = 12*c11
      mat(6, 2, 3) = -20*c12
      mat(6, 2, 4) = -16*(2*c11 - c12)
      mat(6, 2, 5) = -16*(3*c11 + c12)
      mat(6, 2, 6) = 48*c11
      mat(6, 3, 1) = 32*(c11 + c12)
      mat(6, 3, 2) = -16*c11
      mat(6, 3, 3) = 48*c12
      mat(6, 3, 4) = -16*(c11 - c12)
      mat(6, 3, 5) = 16*(3*c11 - c12)
      mat(6, 3, 6) = -16*(3*c11 + 5*c12)
      mat(6, 4, 1) = -80*(c11 + c12)
      mat(6, 4, 2) = 16*c11
      mat(6, 4, 3) = 16*c12
      mat(6, 4, 4) = 64*(c11 - 2*c12)
      mat(6, 4, 5) = 128*(c11 + c12)
      mat(6, 4, 6) = -64*(2*c11 - c12)
      mat(6, 5, 1) = -16*(c11 + c12)
      mat(6, 5, 2) = 16*c11
      mat(6, 5, 3) = 80*c12
      mat(6, 5, 4) = -128*c12
      mat(6, 5, 5) = 64*(3*c11 + 2*c12)
      mat(6, 5, 6) = -64*(3*c11 + c12)
      mat(6, 6, 1) = -160*(c11 + c12)
      mat(6, 6, 2) = -96*c11
      mat(6, 6, 3) = 160*c12
      mat(6, 6, 4) = 128*(2*c11 - c12)
      mat(6, 6, 5) = 128*(3*c11 + c12)
      mat(6, 6, 6) = -384*c11

      factor = 2520
      factor2 = dt / factor
      do k=1,6
        do j=1,6
          do i=1,6
            mat(i,j,k) = mat(i,j,k) * factor2
          enddo
        enddo
      enddo
c
      return
      end

